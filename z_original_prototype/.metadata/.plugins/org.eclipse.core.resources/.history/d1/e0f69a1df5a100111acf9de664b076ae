package assassins.ui.prototypes;

import org.bson.types.ObjectId;

import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.Toast;

import com.google.android.maps.MapActivity;



//public class SearchMode extends Activity {
public class SearchMode extends MapActivity {
	
	private MatchMapView mapView;

	private LocationUpdater updater;
	
    private ObjectId profileId;
	
	@Override
	public void onCreate(Bundle savedInstanceState) {
		 super.onCreate(savedInstanceState);
	     setContentView(R.layout.search_mode);
	     
	     mapView = (MatchMapView) findViewById(R.id.map_view);
	     mapView.setBuiltInZoomControls(true);
	     
	     String objIdStr = getIntent().getStringExtra("profileId");
	     profileId = ObjectId.massageToObjectId(objIdStr); 
   
	     
			Button attack = (Button)findViewById(R.id.attack_button);
			attack.setOnClickListener(new View.OnClickListener() {
				public void onClick(View view) {
					AssassinsHttpClient httpC = new AssassinsHttpClient(getString(R.string.serviceUrl), view.getContext());
					GameSnapshot attackResults = null;
					
					try {
						attackResults = httpC.attackTarget(profileId);
						//Toast.makeText(getApplicationContext(), attackResponse, Toast.LENGTH_SHORT).show();
						
					} catch (AssassinsHttpException e) {
						Log.d("Project Assasins", e.getMessage(), e.getCause());
					}
					
					//This might cause threading issues, since another thread
					if(attackResults != null)
					{
						updater.updateSnapshot(attackResults);
					}
					view.postInvalidate();
				}
			});
		 
		mapView.initLocationUpdates(profileId);
			  	  
	}

	
	@Override
	protected boolean isRouteDisplayed() {
		return false;
	}
}
